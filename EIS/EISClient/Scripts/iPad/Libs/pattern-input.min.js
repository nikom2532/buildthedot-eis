(function(e){function t(e,t,n){var r=-1;var i=-1;if((t-e.border)%e.dotHSpace<=e.dotSize){r=Math.floor((t-e.border)/e.dotHSpace);if(r>e.horizontalDots-1){r=-1}}if((n-e.border)%e.dotVSpace<=e.dotSize){i=Math.floor((n-e.border)/e.dotVSpace);if(i>e.verticalDots-1){i=-1}}if(r>-1&&i>-1){return i*e.horizontalDots+r}else{return-1}}function n(e,t){var n=Math.floor(t/e.horizontalDots);var r=t-n*e.horizontalDots;var i=r*e.dotHSpace+e.border+e.dotSize/2;var s=n*e.dotVSpace+e.border+e.dotSize/2;return[i,s]}function r(e){var t=e.canvas[0];t.width=t.width;var n=t.getContext("2d");n.strokeStyle=e.pathColor;n.lineWidth=e.pathSize;for(var r=0;r<e.dots.length;r++){e.dots[r].removeClass("selected")}}function i(e){if(e.value&&e.value.length>1){var t=e.canvas[0].getContext("2d");for(var r=0;r<e.value.length-1;r++){var i=n(e,e.value[r]);var s=n(e,e.value[r+1]);t.moveTo(i[0],i[1]);t.lineTo(s[0],s[1]);t.stroke()}}}function s(e,n,i){e.value=[];r(e);var s=t(e,n,i);if(s>-1){e.value.push(s);e.lastHit=s;e.dots[s].addClass("selected");e.onChange(e.value);e.logger("onChange: SEQ="+e.value.join(","))}}function o(e,n,r){var s=t(e,n,r);if(s>-1){if(e.lastHit!=s){e.value.push(s);e.lastHit=s;e.dots[s].addClass("selected");e.logger("onChange: SEQ="+e.value.join(","));i(e);setTimeout(function(){e.onChange(e.value)},10)}}}function u(e){if(e.value&&e.value.length>0){e.lastSequence=e.value;setTimeout(function(){e.onFinish(e.value)},10);if(e.autoClear){r(e)}e.logger("onFinish: SEQ="+e.value.join(","))}}var a={init:function(t){var n=e.extend({width:300,height:300,border:20,verticalDots:3,horizontalDots:3,dotSize:100,innerDotSize:40,pathSize:20,autoClear:true,pathColor:"#AAAAAA",onChange:function(){},onFinish:function(){},logger:function(){}},t);return this.each(function(){var t=e(this);if(this.tagName=="DIV"){t.attr("unselectable","on").css("user-select","none");if(t.css("position")=="static"){t.css("position","relative")}var r=t.data("patternInput");if(!r){r=n;t.data("patternInput",r);t.empty();t.addClass("patternInput");t.width(r.width).height(r.height);r.canvas=e('<canvas width="'+r.width+'" height="'+r.height+'" style="position:absolute;left:0px;top:0px;"></canvas>');t.append(r.canvas);var i=r.canvas[0].getContext("2d");i.strokeStyle=r.pathColor;i.lineWidth=r.pathSize;r.dots=[];var a=r.border;var f=a;var l=a;r.dotHSpace=(r.width-r.dotSize-r.border*2)/(r.horizontalDots-1);r.dotVSpace=(r.height-r.dotSize-r.border*2)/(r.verticalDots-1);for(var c=0;c<r.verticalDots;c++){for(var h=0;h<r.horizontalDots;h++){var p=e('<div class="dot" style="width:'+r.dotSize+"px;"+"height:"+r.dotSize+"px;"+"position: absolute; "+"left:"+f+"px; "+"top:"+l+'px;">'+'<div class="innerDot" style="position:absolute;'+"width:"+r.innerDotSize+"px;"+"height:"+r.innerDotSize+"px;"+"left:"+(r.dotSize-r.innerDotSize)/2+"px; "+"top:"+(r.dotSize-r.innerDotSize)/2+'px;">'+"</div>"+"</div>");t.append(p);r.dots.push(p);f+=r.dotHSpace}f=a;l+=r.dotVSpace}t.on("mousedown",function(e){var t=e.pageX-this.offsetLeft;var n=e.pageY-this.offsetTop;r.mouseDown=true;s(r,t,n)});t.on("mousemove",function(e){if(r.mouseDown==true){var t=e.pageX-this.offsetLeft;var n=e.pageY-this.offsetTop;o(r,t,n)}});t.on("mouseup",function(e){if(r.mouseDown==true){r.mouseDown=false;u(r)}});e(document).on("mouseup",function(e){if(r.mouseDown==true){r.mouseDown=false;u(r)}});t.on("touchstart",function(e){var t=e.originalEvent.targetTouches[0].pageX-this.offsetLeft;var n=e.originalEvent.targetTouches[0].pageY-this.offsetTop;s(r,t,n);r.touchDown=true});t.on("touchmove",function(e){var t=e.originalEvent.targetTouches[0].pageX-this.offsetLeft;var n=e.originalEvent.targetTouches[0].pageY-this.offsetTop;o(r,t,n)});t.on("touchend",function(e){u(r)})}}})},clear:function(){var e=this.data("patternInput");r(e);return this},getLastSequence:function(){var e=this.data("patternInput");return e.lastSequence}};e.fn.patternInput=function(t){if(a[t]){return a[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return a.init.apply(this,arguments)}else{e.error("Invalid method call. Method '"+t+"' does not exist on jQuery.patternInput")}}})(jQuery)